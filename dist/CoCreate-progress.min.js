/* CoCreateJS */
var CoCreateProgress={selector:".progress-wrapper",mainObjects:[],init:function(){this.initElement(),this.initEvent()},initElement:function(t){let e=this;(t||document).querySelectorAll(this.selector).forEach(t=>{let r=g_cocreateFilter.setFilter(t,"data-progress_id","progress");if(!r)return;let a={el:t,filter:r,id:t.getAttribute("data-progress_id")};e.mainObjects.push(a),e.fetchProgess(t)})},initEvent:function(){let t=this;CoCreateSocket.listen("readDocumentList",function(e){"progress-total"==e.metadata?t.renderProgress(e,!0):"progress-value"==e.metadata&&t.renderProgress(e,!1)})},renderProgress(t,e){if(!t)return;const r=t.element;if(!r)return;const a=t.data.length;let o=this,s=[],i=e?".progressTotal":".progressValue";i+=`[data-progress_id="${r}"]`,(s=document.querySelectorAll(i)).forEach(t=>{t.textContent=a}),(s=document.querySelectorAll(`.progressbar[data-progress_id="${r}"]`)).forEach(t=>{e?t.setAttribute("data-total",a):t.setAttribute("data-value",a),o.renderBar(t)})},renderBar:function(t){const e=Number(t.getAttribute("data-total")),r=Number(t.getAttribute("data-value"));if(!e||!r||0===e)return;const a=r/e*100;t.innerHTML=`<div style="width: ${a}%"></div>`},fetchProgess:function(t){let e=null,r=t.getAttribute("data-progress_id");if(this.mainObjects.forEach(t=>{t.id==r&&(e=t)}),!e)return;let a=e.filter;console.log(a);let o=g_cocreateFilter.makeFetchOptions(a),s=g_cocreateFilter.makeFetchOptions(a),i=t.getAttribute("data-progress_name"),n=t.getAttribute("data-progress_value"),l=t.getAttribute("data-progress_operator")||"contain";o.metadata="progress-total",s.metadata="progress-value";let c=[].concat(s.operator.filters);c.push({name:i,value:[n],operator:l}),s.operator.filters=c,CoCreate.readDocumentList(o),CoCreate.readDocumentList(s)}};CoCreateProgress.init();