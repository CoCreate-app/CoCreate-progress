!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CoCreate=e():(t.CoCreate=t.CoCreate||{},t.CoCreate.progress=e())}(this,(function(){return(()=>{"use strict";var t={};return(()=>{var e=t;e.default=void 0;var r={selector:".progress-wrapper",mainObjects:[],init:function(){this.initElement(),this.initEvent()},initElement:function(t){let e=(t||document).querySelectorAll(this.selector),r=this;e.forEach((t=>{let e=CoCreate.filter.setFilter(t,"data-progress_id","progress");if(!e)return;let a={el:t,filter:e,id:t.getAttribute("data-progress_id")};r.mainObjects.push(a),r.fetchProgess(t)}))},initEvent:function(){let t=this;CoCreate.socket.listen("readDocumentList",(function(e){"progress-total"==e.metadata?t.renderProgress(e,!0):"progress-value"==e.metadata&&t.renderProgress(e,!1)}))},renderProgress(t,e){if(!t)return;const r=t.element;if(!r)return;const a=t.data.length;let o=this,s=[],i=e?".progressTotal":".progressValue";i+=`[data-progress_id="${r}"]`,s=document.querySelectorAll(i),s.forEach((t=>{t.textContent=a})),s=document.querySelectorAll(`.progressbar[data-progress_id="${r}"]`),s.forEach((t=>{"PROGRESS"===t.tagName?e?t.setAttribute("max",a):t.setAttribute("value",a):(e?t.setAttribute("data-total",a):t.setAttribute("data-value",a),o.renderBar(t))}))},renderBar:function(t){const e=Number(t.getAttribute("data-total")),r=Number(t.getAttribute("data-value"));if(!e||!r||0===e)return;const a=r/e*100;t.innerHTML=`<div style="width: ${a}%"></div>`},fetchProgess:function(t){let e=null,r=t.getAttribute("data-progress_id");if(this.mainObjects.forEach((t=>{t.id==r&&(e=t)})),!e)return;let a=e.filter,o=CoCreate.filter.makeFetchOptions(a),s=CoCreate.filter.makeFetchOptions(a),i=t.getAttribute("data-progress_name"),n=t.getAttribute("data-progress_value"),u=t.getAttribute("data-progress_operator")||"contain";o.metadata="progress-total",s.metadata="progress-value";let l=[].concat(s.operator.filters);l.push({name:i,value:[n],operator:u}),s.operator.filters=l,CoCreate.crud.readDocumentList(o),CoCreate.crud.readDocumentList(s)}};r.init();var a=r;e.default=a})(),t=t.default})()}));